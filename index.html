<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Interactive LP Solver (glpk.js)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2em;
      background-color: #fafafa;
    }
    h1 {
      margin-bottom: 0.5em;
    }
    .section {
      background: #fff;
      margin-bottom: 1.5em;
      padding: 1em;
      border-radius: 5px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }
    .input-row {
      margin-bottom: 0.5em;
    }
    label {
      display: inline-block;
      width: 280px;
      font-weight: bold;
    }
    input[type="number"] {
      width: 100px;
    }
    .solve-btn {
      margin: 1em 0;
      padding: 0.5em 1em;
      font-size: 1em;
      cursor: pointer;
    }
    .output {
      margin-top: 1em;
      font-weight: bold;
    }
    .code-link {
      display: inline-block;
      margin-top: 1em;
    }
  </style>
</head>
<body>

<!-- Title / Description -->
<div class="section">
  <h1>Interactive Linear Programming Solver (Browser-based)</h1>
  <p>
    This page demonstrates how to solve a small LP in the browser using <strong>glpk.js</strong>. 
    You can adjust costs, capacities, and demand in the fields below, then click 
    <em>Solve LP</em> to compute the optimal purchase plan.
  </p>
  <p>
    The scenario: We need to buy <strong>Material A</strong> and <strong>Material B</strong> 
    from two suppliers (X and Y) to meet the demand for our final product. 
    Each product unit requires some amount of A and B. 
    We aim to <strong>minimize total cost</strong>.
  </p>
</div>

<!-- Input Form -->
<div class="section">
  <h2>1. Model Inputs</h2>
  
  <!-- Demand + Materials per unit -->
  <div class="input-row">
    <label for="numUnits">Final Product Demand (units):</label>
    <input type="number" id="numUnits" value="1000" min="0">
  </div>
  <div class="input-row">
    <label for="matAReq">Material A per product (kg/unit):</label>
    <input type="number" id="matAReq" value="2" min="0">
  </div>
  <div class="input-row">
    <label for="matBReq">Material B per product (kg/unit):</label>
    <input type="number" id="matBReq" value="1" min="0">
  </div>

  <hr>

  <!-- Supplier X capacities + costs -->
  <h3>Supplier X</h3>
  <div class="input-row">
    <label for="xCapA">Capacity for A (kg):</label>
    <input type="number" id="xCapA" value="1600" min="0">
  </div>
  <div class="input-row">
    <label for="xCapB">Capacity for B (kg):</label>
    <input type="number" id="xCapB" value="800" min="0">
  </div>
  <div class="input-row">
    <label for="xCostA">Cost of A ($/kg):</label>
    <input type="number" id="xCostA" value="10" step="0.1" min="0">
  </div>
  <div class="input-row">
    <label for="xCostB">Cost of B ($/kg):</label>
    <input type="number" id="xCostB" value="20" step="0.1" min="0">
  </div>

  <hr>

  <!-- Supplier Y capacities + costs -->
  <h3>Supplier Y</h3>
  <div class="input-row">
    <label for="yCapA">Capacity for A (kg):</label>
    <input type="number" id="yCapA" value="2000" min="0">
  </div>
  <div class="input-row">
    <label for="yCapB">Capacity for B (kg):</label>
    <input type="number" id="yCapB" value="500" min="0">
  </div>
  <div class="input-row">
    <label for="yCostA">Cost of A ($/kg):</label>
    <input type="number" id="yCostA" value="9" step="0.1" min="0">
  </div>
  <div class="input-row">
    <label for="yCostB">Cost of B ($/kg):</label>
    <input type="number" id="yCostB" value="22" step="0.1" min="0">
  </div>

  <hr>

  <button class="solve-btn" id="solveBtn">Solve LP</button>
  <div id="solution" class="output"></div>
</div>

<!-- Include glpk.js from a CDN -->
<script src="https://cdn.jsdelivr.net/npm/glpk.js@0.19.2/dist/glpk.min.js"></script>

<script>
  /*
    We'll build the LP model dynamically based on the user's inputs.
    Then we'll call glpk.solve() to get the optimal purchase plan
    (x_XA, x_XB, x_YA, x_YB).
  */

  // Grab DOM elements
  const solveBtn = document.getElementById('solveBtn');
  const solutionDiv = document.getElementById('solution');

  solveBtn.addEventListener('click', () => {
    // 1) Read user inputs
    const numUnits = parseFloat(document.getElementById('numUnits').value);
    const matAReq = parseFloat(document.getElementById('matAReq').value);
    const matBReq = parseFloat(document.getElementById('matBReq').value);

    const xCapA = parseFloat(document.getElementById('xCapA').value);
    const xCapB = parseFloat(document.getElementById('xCapB').value);
    const xCostA = parseFloat(document.getElementById('xCostA').value);
    const xCostB = parseFloat(document.getElementById('xCostB').value);

    const yCapA = parseFloat(document.getElementById('yCapA').value);
    const yCapB = parseFloat(document.getElementById('yCapB').value);
    const yCostA = parseFloat(document.getElementById('yCostA').value);
    const yCostB = parseFloat(document.getElementById('yCostB').value);

    // 2) Compute total A & B needed to produce 'numUnits' of the final product
    const totalARequired = matAReq * numUnits;  // e.g. 2 * 1000 = 2000 kg
    const totalBRequired = matBReq * numUnits;  // e.g. 1 * 1000 = 1000 kg

    // 3) Define the LP in a format glpk.js can process
    // Decision variables: x_XA, x_XB, x_YA, x_YB
    // Objective: Minimize cost = xCostA*x_XA + xCostB*x_XB + yCostA*x_YA + yCostB*x_YB
    const lpProblem = {
      name: "ProcurementLP",
      objective: {
        direction: glpk.GLP_MIN,
        name: "obj",
        vars: [
          { name: "x_XA", coef: xCostA },
          { name: "x_XB", coef: xCostB },
          { name: "x_YA", coef: yCostA },
          { name: "x_YB", coef: yCostB }
        ]
      },
      subjectTo: [
        // Demand for A: x_XA + x_YA >= totalARequired
        {
          name: "A_Demand",
          vars: [
            { name: "x_XA", coef: 1 },
            { name: "x_YA", coef: 1 }
          ],
          bnds: {
            type: glpk.GLP_LO,  // >=
            val: totalARequired
          }
        },
        // Demand for B: x_XB + x_YB >= totalBRequired
        {
          name: "B_Demand",
          vars: [
            { name: "x_XB", coef: 1 },
            { name: "x_YB", coef: 1 }
          ],
          bnds: {
            type: glpk.GLP_LO,  // >=
            val: totalBRequired
          }
        },
        // Supplier X capacity for A: x_XA <= xCapA
        {
          name: "X_A_Cap",
          vars: [
            { name: "x_XA", coef: 1 }
          ],
          bnds: {
            type: glpk.GLP_UP,  // <=
            val: xCapA
          }
        },
        // Supplier X capacity for B: x_XB <= xCapB
        {
          name: "X_B_Cap",
          vars: [
            { name: "x_XB", coef: 1 }
          ],
          bnds: {
            type: glpk.GLP_UP,
            val: xCapB
          }
        },
        // Supplier Y capacity for A: x_YA <= yCapA
        {
          name: "Y_A_Cap",
          vars: [
            { name: "x_YA", coef: 1 }
          ],
          bnds: {
            type: glpk.GLP_UP,
            val: yCapA
          }
        },
        // Supplier Y capacity for B: x_YB <= yCapB
        {
          name: "Y_B_Cap",
          vars: [
            { name: "x_YB", coef: 1 }
          ],
          bnds: {
            type: glpk.GLP_UP,
            val: yCapB
          }
        }
      ],
      bounds: [
        // Non-negativity
        { name: "x_XA", type: glpk.GLP_LO, val: 0 },
        { name: "x_XB", type: glpk.GLP_LO, val: 0 },
        { name: "x_YA", type: glpk.GLP_LO, val: 0 },
        { name: "x_YB", type: glpk.GLP_LO, val: 0 }
      ]
    };

    // 4) Solve the LP with glpk.js
    const result = glpk.solve(lpProblem);

    // 5) Display the solution
    if (result.result) {
      // Extract variable values
      const x_XA_val = result.result.x_XA?.toFixed(2) ?? 0;
      const x_XB_val = result.result.x_XB?.toFixed(2) ?? 0;
      const x_YA_val = result.result.x_YA?.toFixed(2) ?? 0;
      const x_YB_val = result.result.x_YB?.toFixed(2) ?? 0;
      const totalCost = result.result.z?.toFixed(2) ?? "N/A";

      solutionDiv.innerHTML = `
        <div>Optimal solution found:</div>
        <ul>
          <li><strong>Supplier X</strong>, Material A: ${x_XA_val} kg</li>
          <li><strong>Supplier X</strong>, Material B: ${x_XB_val} kg</li>
          <li><strong>Supplier Y</strong>, Material A: ${x_YA_val} kg</li>
          <li><strong>Supplier Y</strong>, Material B: ${x_YB_val} kg</li>
        </ul>
        <div>Minimum Total Cost: <strong>$${totalCost}</strong></div>
      `;
    } else {
      // Possibly infeasible or error
      solutionDiv.innerHTML = "<span style='color:red'>No feasible solution found.</span>";
    }
  });
</script>

</body>
</html>

